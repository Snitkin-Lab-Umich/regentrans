f1_allele1 = allele_freq_btwn(x, subset_f1, 1, alleles)
within_f2_sum <- within_pop_var(subset_snp_mat, subset_f2)
allele_freq_btwn <- function(x, subset, allele_n, alleles){
#checks
check_allele_freq_input(x, subset, allele_n, alleles)
#calculate
return(sum(as.character(x)[subset] %in% alleles[allele_n])/sum(subset))
}
allele_freq_within <- function(x, allele_n, alleles){
#checks
check_allele_freq_input(x, subset = NULL, allele_n, alleles)
#calculate
return(sum(as.character(x) %in% alleles[allele_n])/length(x))
}
within_pop_var <- function(subset_snp_mat, subset){
#checks
within_pop_var_input_checks(subset_snp_mat, subset)
f_subset_snp_mat = subset_snp_mat[subset,apply(subset_snp_mat[subset,], 2, FUN = function(x){sum(x != x[1] | x == 'N') > 0})]
within_f = apply(f_subset_snp_mat, 2, FUN = function(x){
alleles = names(table(as.character(x)))
if (length(alleles) > 2){0}else{
f_allele1 = allele_freq_within(x, 1, alleles)
f_allele2 = allele_freq_within(x, 2, alleles)
(f_allele1 * f_allele2)^2}
})
return(sum(within_f))
}
f1_allele1 = allele_freq_btwn(x, subset_f1, 1, alleles)
within_f1_sum <- within_pop_var(subset_snp_mat, subset_f1)
source("/Users/sophiehoffman/Desktop/regentrans/R/checks.R")
source("/Users/sophiehoffman/Desktop/regentrans/R/checks.R")
within_f1_sum <- within_pop_var(subset_snp_mat, subset_f1)
f2_allele2 = allele_freq_btwn(x, subset_f2, 2, alleles)
Penn_all_input <- readRDS(file = "/Users/sophiehoffman/Desktop/regentrans/extras/Penn_test_input_all.rds")
locs_Penn <- Penn_all_input$locs
pt_Penn <- Penn_all_input$pt
fasta_Penn <- Penn_all_input$fasta
dists_Penn <- Penn_all_input$dists
tr_Penn <- Penn_all_input$tr
#dists - snv distance matrix returned by dist.dna
#use as.matrix = true for the dist.dna function
dists_Penn <- dist.dna(x = fasta_Penn, as.matrix = TRUE, model = "N", pairwise.deletion = TRUE)
library(ape)
library(dplyr)
library(devtools)
#source checks
source("/Users/sophiehoffman/Desktop/regentrans/R/checks.R")
#source tests
source("/Users/sophiehoffman/Desktop/regentrans/R/tests.R")
#source get_snv_dists
source("/Users/sophiehoffman/Desktop/regentrans/R/get_snv_dists.R")
#source get_frac_intra
source("/Users/sophiehoffman/Desktop/regentrans/R/get_frac_intra.R")
#source get_largest_subtree
source("/Users/sophiehoffman/Desktop/regentrans/R/get_largest_subtree.R")
#source reverse_list_str
source("/Users/sophiehoffman/Desktop/regentrans/R/reverse_list_str.R")
#source get_clusters
source("/Users/sophiehoffman/Desktop/regentrans/R/get_clusters.R")
#source get_facility_fsp
source("/Users/sophiehoffman/Desktop/regentrans/R/get_facility_fsp.R")
#dists - snv distance matrix returned by dist.dna
#use as.matrix = true for the dist.dna function
dists_Penn <- dist.dna(x = fasta_Penn, as.matrix = TRUE, model = "N", pairwise.deletion = TRUE)
Penn_all_input <- list("locs" = locs_Penn, "pt" = pt_Penn, "fasta" = fasta_Penn, "dists" = dists_Penn, "tr" = tree_Penn)
getwd()
setwd("/Users/sophiehoffman/Desktop/regentrans/extras")
saveRDS(Penn_all_input, file = "Penn_test_input_all.rds")
Penn_all_input <- readRDS(file = "/Users/sophiehoffman/Desktop/regentrans/extras/Penn_test_input_all.rds")
locs_Penn <- Penn_all_input$locs
pt_Penn <- Penn_all_input$pt
fasta_Penn <- Penn_all_input$fasta
dists_Penn <- Penn_all_input$dists
tr_Penn <- Penn_all_input$tr
colors <- c("Intra-facility pair" = "red", "Inter-facility pair" = "blue")
ggplot() +
geom_histogram(data = subset(snv_dists_df,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 100), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 100), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.5) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors)
snv_dists_Penn <- get_snv_dists(dists_Penn, locs_Penn, pt_Penn)
snv_dists_df_Penn <- as.data.frame(snv_dists_Penn)
colors <- c("Intra-facility pair" = "red", "Inter-facility pair" = "blue")
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.5) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + facet_wrap(~ Loc1)
library(ggplot2)
snv_dists_Penn <- get_snv_dists(dists_Penn, locs_Penn, pt_Penn)
snv_dists_df_Penn <- as.data.frame(snv_dists_Penn)
colors <- c("Intra-facility pair" = "red", "Inter-facility pair" = "blue")
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.5) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + facet_wrap(~ Loc1)
snv_dists_Penn <- get_snv_dists(dists_Penn, locs_Penn, pt_Penn)
snv_dists_df_Penn <- as.data.frame(snv_dists_Penn)
colors <- c("Intra-facility pair" = "red", "Inter-facility pair" = "blue")
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.5) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + facet_wrap(~ Loc1) + ggtitle("All Penn Isolate Pairs < 1000 SNV distance by facility")
colors <- c("Intra-facility pair" = "red", "Inter-facility pair" = "blue")
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.5) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors)
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.5) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairse < 1000 SNV distance")
#dists - snv distance matrix returned by dist.dna
#use as.matrix = true for the dist.dna function
dists_Penn <- dist.dna(x = fasta_Penn, as.matrix = TRUE, model = "N", pairwise.deletion = TRUE)
snv_dists_Penn <- get_snv_dists(dists_Penn, locs_Penn, pt_Penn)
snv_dists_df_Penn <- as.data.frame(snv_dists_Penn)
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.5) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairse < 1000 SNV distance")
##save penn data
Penn_all_input <- list("locs" = locs_Penn, "pt" = pt_Penn, "fasta" = fasta_Penn, "dists" = dists_Penn, "tr" = tr_Penn)
setwd("/Users/sophiehoffman/Desktop/regentrans/extras")
saveRDS(Penn_all_input, file = "Penn_test_input_all.rds")
Penn_all_input <- readRDS(file = "/Users/sophiehoffman/Desktop/regentrans/extras/Penn_test_input_all.rds")
locs_Penn <- Penn_all_input$locs
pt_Penn <- Penn_all_input$pt
fasta_Penn <- Penn_all_input$fasta
dists_Penn <- Penn_all_input$dists
tr_Penn <- Penn_all_input$tr
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.5) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairse < 1000 SNV distance")
snv_dists_Penn <- get_snv_dists(dists_Penn, locs_Penn, pt_Penn)
snv_dists_df_Penn <- as.data.frame(snv_dists_Penn)
colors <- c("Intra-facility pair" = "red", "Inter-facility pair" = "blue")
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.5) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + facet_wrap(~ Loc1) + ggtitle("All Penn Isolate Pairs < 1000 SNV distance by facility")
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.5) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairse < 1000 SNV distance")
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors)
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2, binwidth = 20) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2, binwidth = 20) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 20 SNV distance")
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2, binwidth = 10) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2, binwidth = 10) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 20 SNV distance")
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2, binwidth = 30) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2, binwidth = 30) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 20 SNV distance")
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2, binwidth = 1) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2, binwidth = 1) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 20 SNV distance")
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 30), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2, binwidth = 1) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 30), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2, binwidth = 1) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 20 SNV distance")
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2, binwidth = 1) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2, binwidth = 1) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 20 SNV distance")
colors <- c("Intra-facility pair" = "red", "Inter-facility pair" = "blue")
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + facet_wrap(~ Loc1)
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2, binwidth = 1) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2, binwidth = 1) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 20 SNV distance by Facility") + facet_wrap(~ Loc1)
snv_dists_Penn <- get_snv_dists(dists_Penn, locs_Penn, pt_Penn)
snv_dists_df_Penn <- as.data.frame(snv_dists_Penn)
colors <- c("Intra-facility pair" = "red", "Inter-facility pair" = "blue")
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.5) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + facet_wrap(~ Loc1, ncol = 4) + ggtitle("All Penn Isolate Pairs < 1000 SNV distance by facility")
metadata_penn <- read.csv("/Users/sophiehoffman/Desktop/gl_mount/Project_Penn_KPC/Analysis/regentrans_data/2021-02-16_subset-data/data/ltach-metadata.csv")
View(metadata_penn)
snv_dists_Penn <- get_snv_dists(dists_Penn, locs_Penn, pt_Penn)
snv_dists_df_Penn <- as.data.frame(snv_dists_Penn)
View(snv_dists_df_Penn)
metadata_penn$isolate_char <- paste0("PCMP_H", metadata_penn$isolate_no)
snv_dists_df_Penn_dated <- snv_dists_df_Penn %>% left_join(metadata_penn, by = c("isolate_char" == "Isolate1"))
snv_dists_df_Penn_dated <- snv_dists_df_Penn %>% left_join(metadata_penn, by = c("isolate_char" = "Isolate1"))
snv_dists_df_Penn_dated <- snv_dists_df_Penn %>% left_join(metadata_penn, by = c("Isolate1" = "isolate_char"))
View(snv_dists_df_Penn_dated)
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2, binwidth = 1) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2, binwidth = 1) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 20 SNV distance by Facility") + facet_wrap(~ cx_date, ncol = 4)
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2, binwidth = 1) +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2, binwidth = 1) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 20 SNV distance by Facility") + facet_wrap(~ cx_date, ncol = 4)
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2, binwidth = 1) +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2, binwidth = 1) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 1000 SNV distance by Date of first isolate") + facet_wrap(~ cx_date, ncol = 4)
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 1000 SNV distance by Date of first isolate") + facet_wrap(~ cx_date, ncol = 4)
#run get clusters
clusters <- get_clusters(tr_Penn,locs_Penn)
#run get clusters
#subset locs_Penn to have the same as tr_Penn
common <- intersect(tr_Penn$tip.label, names(locs_Penn))
locs_Penn_tr_sub <- locs_Penn[common]
clusters <- get_clusters(tr_Penn,locs_Penn)
clusters <- get_clusters(tr_Penn,locs_Penn_tr_sub)
pure_subtree_info <- clusters$pure_subtree_info
View(pure_subtree_info)
ggplot(data = pure_subtree_info) + geom_dotplot(aes(x = f_id, y = subtr_size), binaxis='y', stackdir='center')
ggplot(data = pure_subtree_info) + geom_dotplot(aes(x = f_id, y = subtr_size), binaxis='x', stackdir='center')
ggplot(data = pure_subtree_info) + geom_dotplot(aes(x = f_id, y = subtr_size), binaxis='y', stackdir='center')
ggplot(data = pure_subtree_info) + geom_dotplot(aes(x = f_id, y = subtr_size), binaxis='y', stackdir='center', dotsize=1.2)
ggplot(data = pure_subtree_info) + geom_dotplot(aes(x = f_id, y = subtr_size), binaxis='y', stackdir='center', dotsize=.5)
ggplot(data = pure_subtree_info) + geom_dotplot(aes(x = f_id, y = subtr_size), binaxis='x', stackdir='center', dotsize=.5)
ggplot(data = pure_subtree_info) + geom_dotplot(aes(x = f_id, y = subtr_size), binaxis='x', stackdir='center', dotsize=.5, alpha = 0.2) + scale_fill_brewer(palette="Dark2")
ggplot(data = pure_subtree_info) + geom_dotplot(aes(x = f_id, y = subtr_size), binaxis='x', stackdir='center', dotsize=.5) + scale_fill_brewer(palette="Dark2")
ggplot(data = subset(pure_subtree_info, f_id %in% c("A", "B", "C"))) + geom_dotplot(aes(x = f_id, y = subtr_size), binaxis='y', stackdir='center', dotsize=.5, alpha = 0.2)
ggplot(data = subset(pure_subtree_info, f_id %in% c("A", "B", "C", "D", "E"))) + geom_dotplot(aes(x = f_id, y = subtr_size), binaxis='y', stackdir='center', dotsize=.5, alpha = 0.2)
ggplot(data = subset(pure_subtree_info, f_id %in% c("A", "B", "C", "D", "E")), aes(x = f_id, y = subtr_size)) + geom_jitter(position = position_jitter(width = 0.1, height = 0.1))
ggplot(data = pure_subtree_info, aes(x = f_id, y = subtr_size)) + geom_jitter(position = position_jitter(width = 0.1, height = 0.1))
ggplot(data = pure_subtree_info, aes(x = f_id, y = subtr_size)) + geom_jitter(position = position_jitter(width = 0.1, height = 0.1))
ggplot(data = pure_subtree_info, aes(x = f_id, y = subtr_size)) + geom_jitter(position = position_jitter(width = 0.1, height = 0.1), alpha = 0.2)
#run get clusters
#subset locs_Penn to have the same as tr_Penn
common <- intersect(tr_Penn$tip.label, names(locs_Penn))
locs_Penn_tr_sub <- locs_Penn[common]
clusters <- get_clusters(tr_Penn,locs_Penn_tr_sub)
ggplot(data = pure_subtree_info, aes(x = f_id, y = subtr_size)) + geom_jitter(position = position_jitter(width = 0.1, height = 0.1), alpha = 0.2)
ggplot(data = pure_subtree_info, aes(x = f_id, y = subtr_size)) + geom_jitter(position = position_jitter(width = 0.1, height = 0.1), alpha = 0.2) + labs(x = "Number of Isolates in Phylogenetic Cluster", y = "Facility ID", title = "Pure Subtree Information")
ggplot(data = pure_subtree_info, aes(x = f_id, y = subtr_size)) + geom_jitter(position = position_jitter(width = 0.1, height = 0.1), alpha = 0.2) + labs(x = "Number of Isolates in Phylogenetic Cluster", y = "Facility ID", title = "Pure Subtree Information")
ggplot(data = pure_subtree_info, aes(x = f_id, y = subtr_size)) + geom_jitter(position = position_jitter(width = 0.1, height = 0.1), alpha = 0.2) + labs(y = "Number of Isolates in /nPhylogenetic Cluster", x = "Facility ID", title = "Pure Subtree Information")
ggplot(data = pure_subtree_info, aes(x = f_id, y = subtr_size)) + geom_jitter(position = position_jitter(width = 0.1, height = 0.1), alpha = 0.2) + labs(y = "Number of Isolates in \nPhylogenetic Cluster", x = "Facility ID", title = "Pure Subtree Information")
ggplot(data = pure_subtree_info, aes(x = f_id, y = subtr_size)) + geom_jitter(position = position_jitter(width = 0.2, height = 0.2), alpha = 0.2) + labs(y = "Number of Isolates in \nPhylogenetic Cluster", x = "Facility ID", title = "Pure Subtree Information")
ggplot(data = pure_subtree_info, aes(x = f_id, y = subtr_size)) + geom_jitter(position = position_jitter(width = 0.2, height = 0.1), alpha = 0.2) + labs(y = "Number of Isolates in \nPhylogenetic Cluster", x = "Facility ID", title = "Pure Subtree Information")
library(ggtree)
library(pheatmap)
tr_Penn = midpoint.root(tr_Penn)
library(ape)
library(dplyr)
library(devtools)
library(ggtree)
library(pheatmap)
library(ggplot2)
library(phytools)
tr_Penn = midpoint.root(tr_Penn)
gheatmap(ggtree(tr_Penn, layout = "circular"),locs_Penn)
tr_Penn = midpoint.root(tr_Penn)
gheatmap(ggtree(tr_Penn, layout = "circular"),locs_Penn_tr_sub)
locs_Penn_tr_sub
as.data.frame(locs_Penn_tr_sub)
gheatmap(ggtree(tr_Penn, layout = "circular"),as.data.frame(locs_Penn_tr_sub))
tr_Penn = midpoint.root(tr_Penn)
gheatmap(ggtree(tr_Penn, layout = "circular"),as.data.frame(locs_Penn_tr_sub))
tr_Penn <- Penn_all_input$tr
tr_Penn_mpr = midpoint.root(tr_Penn)
gheatmap(ggtree(tr_Penn_mpr, layout = "circular"),as.data.frame(locs_Penn_tr_sub))
kleb <- read.table("/Users/sophiehoffman/Desktop/gl_mount/Project_Penn_KPC/Sequence_data/Reports/kleborate/penn_kleborate_results.txt")
kleb <- read.csv("/Users/sophiehoffman/Desktop/gl_mount/Project_Penn_KPC/Sequence_data/Reports/kleborate/penn_kleborate_results.txt")
kleb <- read.csv("/Users/sophiehoffman/Desktop/gl_mount/Project_Penn_KPC/Sequence_data/Reports/kleborate/penn_kleborate_results.txt", sep = "\t")
View(kleb)
locs <- as.data.frame(locs_Penn_tr_sub)
View(locs)
locs$ID <- rownames(locs)
penn_locs_sub <- locs %>% left_join(kleb, by = c("ID" = "strain"))
View(penn_locs_sub)
penn_locs_sub <- locs %>% left_join(kleb, by = c("ID" = "strain")) %>% filter(ST == "ST258")
penn_locs_sub <- locs %>% left_join(kleb, by = c("ID" = "strain")) %>% filter(ST == "ST258") %>% select(penn_locs_tr_sub, ID, ST)
penn_locs_sub <- locs %>% left_join(kleb, by = c("ID" = "strain")) %>% filter(ST == "ST258")
penn_locs_sub <- locs %>% left_join(kleb, by = c("ID" = "strain")) %>% filter(ST == "ST258") %>% select(ID, ST, locs_Penn_tr_sub)
penn_locs_sub <- locs %>% left_join(kleb, by = c("ID" = "strain")) %>% filter(ST == "ST258") %>% select(ID, locs_Penn_tr_sub)
colnames(penn_locs_sub) <- c("ID", "f_id")
tr_sub keep.tip(tr,penn_locs_sub$ID)
tr_sub <- keep.tip(tr,penn_locs_sub$ID)
tr_sub <- keep.tip(tr_Penn,penn_locs_sub$ID)
tr_Penn_mpr = midpoint.root(tr_sub)
gheatmap(ggtree(tr_Penn_mpr, layout = "circular"),as.data.frame(locs_Penn_tr_sub))
gheatmap(ggtree(tr_Penn_mpr, layout = "circular"),as.data.frame(locs_Penn_tr_sub), color = NA)
gheatmap(ggtree(tr_Penn_mpr, layout = "circular"),as.data.frame(locs_Penn_tr_sub), color = NA)
library(ape)
library(dplyr)
library(devtools)
library(ggtree)
library(pheatmap)
library(ggplot2)
library(phytools)
#load test data
# Penn_test_input <- readRDS(file = "/Users/sophiehoffman/Desktop/regentrans/extras/Penn_test_input_2.rds")
# locs <- Penn_test_input$locs
# pt <- Penn_test_input$pt
# fasta <- Penn_test_input$fasta
# dists <- Penn_test_input$dists
# tr <- Penn_test_input$tr
#load real data
Penn_all_input <- readRDS(file = "/Users/sophiehoffman/Desktop/regentrans/extras/Penn_test_input_all.rds")
locs_Penn <- Penn_all_input$locs
pt_Penn <- Penn_all_input$pt
fasta_Penn <- Penn_all_input$fasta
dists_Penn <- Penn_all_input$dists
tr_Penn <- Penn_all_input$tr
metadata_penn <- read.csv("/Users/sophiehoffman/Desktop/gl_mount/Project_Penn_KPC/Analysis/regentrans_data/2021-02-16_subset-data/data/ltach-metadata.csv")
#source checks
source("/Users/sophiehoffman/Desktop/regentrans/R/checks.R")
#source tests
#source("/Users/sophiehoffman/Desktop/regentrans/R/tests.R")
#source get_snv_dists
source("/Users/sophiehoffman/Desktop/regentrans/R/get_snv_dists.R")
#source get_frac_intra
source("/Users/sophiehoffman/Desktop/regentrans/R/get_frac_intra.R")
#source get_largest_subtree
source("/Users/sophiehoffman/Desktop/regentrans/R/get_largest_subtree.R")
#source reverse_list_str
source("/Users/sophiehoffman/Desktop/regentrans/R/reverse_list_str.R")
#source get_clusters
source("/Users/sophiehoffman/Desktop/regentrans/R/get_clusters.R")
#source get_facility_fsp
source("/Users/sophiehoffman/Desktop/regentrans/R/get_facility_fsp.R")
#set theme
theme_set(theme_bw() + theme(#axis.text.x = element_text(angle=90,vjust = 0.5, hjust = 1),
strip.background = element_rect(fill="white",linetype='blank'), text=element_text(size=15)))
snv_dists_Penn <- get_snv_dists(dists_Penn, locs_Penn, pt_Penn)
snv_dists_df_Penn <- as.data.frame(snv_dists_Penn)
colors <- c("Intra-facility pair" = "red", "Inter-facility pair" = "blue")
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.5) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + facet_wrap(~ Loc1, ncol = 4) + ggtitle("All Penn Isolate Pairs < 1000 SNV distance by facility")
#add time to the snv_dists_df_Penn thing
metadata_penn$isolate_char <- paste0("PCMP_H", metadata_penn$isolate_no)
#add the date of isolate #1 to the snv_dists_df_Penn
snv_dists_df_Penn_dated <- snv_dists_df_Penn %>% left_join(metadata_penn, by = c("Isolate1" = "isolate_char"))
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2, binwidth = 1) +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2, binwidth = 1) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 20 SNV distance by Date of first isolate") + facet_wrap(~ cx_date, ncol = 4)
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 1000 SNV distance by Date by Location of first isolate") + facet_wrap(Loc1 ~ cx_date, ncol = 4)
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 1000 SNV distance by Date by Location of first isolate") + facet_wrap(Loc1 ~ cx_date, ncol = 4)
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 1000 SNV distance by Date by Location of first isolate") + facet_wrap(Loc1 ~ cx_date)
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 1000 SNV distance by Date by Location of first isolate") + facet_wrap(Loc1 ~ cx_date)
library(ape)
library(dplyr)
library(devtools)
library(ggtree)
library(pheatmap)
library(ggplot2)
library(phytools)
#load test data
# Penn_test_input <- readRDS(file = "/Users/sophiehoffman/Desktop/regentrans/extras/Penn_test_input_2.rds")
# locs <- Penn_test_input$locs
# pt <- Penn_test_input$pt
# fasta <- Penn_test_input$fasta
# dists <- Penn_test_input$dists
# tr <- Penn_test_input$tr
#load real data
Penn_all_input <- readRDS(file = "/Users/sophiehoffman/Desktop/regentrans/extras/Penn_test_input_all.rds")
locs_Penn <- Penn_all_input$locs
pt_Penn <- Penn_all_input$pt
fasta_Penn <- Penn_all_input$fasta
dists_Penn <- Penn_all_input$dists
tr_Penn <- Penn_all_input$tr
metadata_penn <- read.csv("/Users/sophiehoffman/Desktop/gl_mount/Project_Penn_KPC/Analysis/regentrans_data/2021-02-16_subset-data/data/ltach-metadata.csv")
library(ape)
library(dplyr)
library(devtools)
library(ggtree)
library(pheatmap)
library(ggplot2)
library(phytools)
#load test data
# Penn_test_input <- readRDS(file = "/Users/sophiehoffman/Desktop/regentrans/extras/Penn_test_input_2.rds")
# locs <- Penn_test_input$locs
# pt <- Penn_test_input$pt
# fasta <- Penn_test_input$fasta
# dists <- Penn_test_input$dists
# tr <- Penn_test_input$tr
#load real data
Penn_all_input <- readRDS(file = "/Users/sophiehoffman/Desktop/regentrans/extras/Penn_test_input_all.rds")
locs_Penn <- Penn_all_input$locs
pt_Penn <- Penn_all_input$pt
fasta_Penn <- Penn_all_input$fasta
dists_Penn <- Penn_all_input$dists
tr_Penn <- Penn_all_input$tr
metadata_penn <- read.csv("/Users/sophiehoffman/Desktop/gl_mount/Project_Penn_KPC/Analysis/regentrans_data/2021-02-16_subset-data/data/ltach-metadata.csv")
#source checks
source("/Users/sophiehoffman/Desktop/regentrans/R/checks.R")
#source tests
#source("/Users/sophiehoffman/Desktop/regentrans/R/tests.R")
#source get_snv_dists
source("/Users/sophiehoffman/Desktop/regentrans/R/get_snv_dists.R")
#source get_frac_intra
source("/Users/sophiehoffman/Desktop/regentrans/R/get_frac_intra.R")
#source get_largest_subtree
source("/Users/sophiehoffman/Desktop/regentrans/R/get_largest_subtree.R")
#source reverse_list_str
source("/Users/sophiehoffman/Desktop/regentrans/R/reverse_list_str.R")
#source get_clusters
source("/Users/sophiehoffman/Desktop/regentrans/R/get_clusters.R")
#source get_facility_fsp
source("/Users/sophiehoffman/Desktop/regentrans/R/get_facility_fsp.R")
#set theme
theme_set(theme_bw() + theme(#axis.text.x = element_text(angle=90,vjust = 0.5, hjust = 1),
strip.background = element_rect(fill="white",linetype='blank'), text=element_text(size=15)))
snv_dists_Penn <- get_snv_dists(dists_Penn, locs_Penn, pt_Penn)
snv_dists_df_Penn <- as.data.frame(snv_dists_Penn)
colors <- c("Intra-facility pair" = "red", "Inter-facility pair" = "blue")
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 1000), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.5) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + facet_wrap(~ Loc1, ncol = 4) + ggtitle("All Penn Isolate Pairs < 1000 SNV distance by facility")
#add time to the snv_dists_df_Penn thing
metadata_penn$isolate_char <- paste0("PCMP_H", metadata_penn$isolate_no)
#add the date of isolate #1 to the snv_dists_df_Penn
snv_dists_df_Penn_dated <- snv_dists_df_Penn %>% left_join(metadata_penn, by = c("Isolate1" = "isolate_char"))
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2, binwidth = 1) +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2, binwidth = 1) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 20 SNV distance by Date of first isolate") + facet_wrap(~ cx_date, ncol = 4)
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 20 SNV distance by Date by Location of first isolate") + facet_wrap(Loc1 ~ cx_date)
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2, binwidth = 1) +
geom_histogram(data = subset(snv_dists_df_Penn_dated,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2, binwidth = 1) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 20 SNV distance by Date by Location of first isolate") + facet_wrap(Loc1 ~ cx_date)
facility_sum = table(locs_Penn)
facility_sum
table(locs_Penn) > 10
facility_sum <- which(unlist(table(locs_Penn) > 10))
locs_Penn_subset <- locs_Penn[locs_Penn %in% names(facility_sum)]
locs_Penn_subset
facility_sum
snv_dists_df_Penn_dated
names(facility_sum)
snv_dists_df_Penn_dated_sub %>% filter(Loc1 %in% names(facility_sum))
snv_dists_df_Penn_dated_sub <- snv_dists_df_Penn_dated %>% filter(Loc1 %in% names(facility_sum))
snv_dists_df_Penn_dated_sub
View(snv_dists_df_Penn)
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn_dated_sub,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2, binwidth = 1) +
geom_histogram(data = subset(snv_dists_df_Penn_dated_sub,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2, binwidth = 1) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 20 SNV distance by Date by Location of first isolate") + facet_wrap(Loc1 ~ cx_date)
ggplot() +
geom_histogram(data = subset(snv_dists_df_Penn_dated_sub,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2, binwidth = 1) +
geom_histogram(data = subset(snv_dists_df_Penn_dated_sub,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.2, binwidth = 1) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") + scale_color_manual(values = colors) + ggtitle("All Penn Isolate Pairs < 20 SNV distance by Date by Location of first isolate") + facet_grid(Loc1 ~ cx_date)
View(snv_dists_df_Penn)
View(snv_dists_df_Penn_dated)
ggplot(data = snv_dists_df_Penn_dated) + geom_histogram(mapping = aes(x = cx_date)) + facet_grid(~Loc1)
snv_dists_df_Penn_dated %>% group_by(cx_date) %>% summarize(n = n())
snv_dists_df_Penn_dated %>% group_by(cx_date) %>% summarize(n = n()) %>% ggplot() + geom_bar(mapping = aes(x = cx_date, y = n))
snv_dists_df_Penn_dated %>% group_by(cx_date) %>% summarize(n = n()) %>% ggplot() + geom_histogram(mapping = aes(x = cx_date, y = n))
snv_dists_df_Penn_dated %>% group_by(cx_date, Loc1) %>% summarize(n = n())
#plot how many isolates are present in each facil in each month
snv_dists_df_Penn_dated %>% group_by(cx_date, Loc1) %>% summarize(n = n()) %>% ggplot() + geom_histogram(mapping = aes(x = cx_date, y = n)) %>% facet_wrap(~ Loc1)
ggplot() + geom_histogram(mapping = aes(x = cx_date, y = n))
#plot how many isolates are present in each facil in each month
n_isolates <- snv_dists_df_Penn_dated %>% group_by(cx_date, Loc1) %>% summarize(n = n()) %>% ggplot() + geom_histogram(mapping = aes(x = cx_date, y = n))
#plot how many isolates are present in each facil in each month
n_isolates <- snv_dists_df_Penn_dated %>% group_by(cx_date, Loc1) %>% summarize(n = n())
ggplot(data = n_isolates) + geom_histogram(mapping = aes(x = cx_date, y = n))
#plot how many isolates are present in each facil in each month
n_isolates <- snv_dists_df_Penn_dated %>% group_by(cx_date, Loc1) %>% summarize(n = n())
ggplot(data = n_isolates) + geom_histogram(mapping = aes(x = cx_date))
#plot how many isolates are present in each facil in each month
n_isolates <- snv_dists_df_Penn_dated %>% group_by(cx_date, Loc1) %>% summarize(n = n())
ggplot(data = n_isolates) + geom_histogram(mapping = aes(x = cx_date, stat = "count"))
#plot how many isolates are present in each facil in each month
n_isolates <- snv_dists_df_Penn_dated %>% group_by(cx_date, Loc1) %>% summarize(n = n())
ggplot(data = n_isolates) + geom_histogram(mapping = aes(x = cx_date), stat = "count")
#plot how many isolates are present in each facil in each month
n_isolates <- snv_dists_df_Penn_dated %>% group_by(cx_date, Loc1) %>% summarize(n = n())
ggplot(data = n_isolates) + geom_histogram(mapping = aes(x = cx_date), stat = "count") %>% facet_wrap(~ Loc1)
View(n_isolates)
#plot how many isolates are present in each facil in each month
n_isolates <- snv_dists_df_Penn_dated %>% group_by(cx_date, Loc1) %>% summarize(n = n())
ggplot(data = n_isolates) + geom_histogram(mapping = aes(x = cx_date), stat = "count", color = Loc1)
#plot how many isolates are present in each facil in each month
n_isolates <- snv_dists_df_Penn_dated %>% group_by(cx_date, Loc1) %>% summarize(n = n())
ggplot(data = n_isolates) + geom_histogram(mapping = aes(x = cx_date, color = Loc1), stat = "count")
#plot how many isolates are present in each facil in each month
n_isolates <- snv_dists_df_Penn_dated %>% group_by(cx_date, Loc1) %>% summarize(n = n())
ggplot(data = n_isolates) + geom_bar(mapping = aes(x = cx_date, fill = Loc1))
#plot how many isolates are present in each facil in each month
n_isolates <- snv_dists_df_Penn_dated %>% group_by(cx_date, Loc1) %>% summarize(n = n())
ggplot(data = n_isolates) + geom_bar(mapping = aes(x = cx_date, y = n, fill = Loc1))
#plot how many isolates are present in each facil in each month
n_isolates <- snv_dists_df_Penn_dated %>% group_by(cx_date, Loc1) %>% summarize(n = n())
ggplot(data = n_isolates) + geom_bar(mapping = aes(x = cx_date, y = n, fill = Loc1), stat = "identity")
#plot how many isolates are present in each facil in each month
n_isolates <- snv_dists_df_Penn_dated %>% group_by(cx_date, Loc1) %>% summarize(n = n())
ggplot(data = n_isolates) + geom_bar(mapping = aes(x = cx_date, y = n, fill = Loc1), stat = "identity", position = "dodge")
#plot how many isolates are present in each facil in each month
n_isolates <- snv_dists_df_Penn_dated %>% group_by(cx_date, Loc1) %>% summarize(n = n())
ggplot(data = n_isolates) + geom_bar(mapping = aes(x = cx_date, y = n, fill = Loc1), stat = "identity", position = "dodge")
#plot how many isolates are present in each facil in each month
n_isolates <- snv_dists_df_Penn_dated %>% group_by(cx_date, Loc1) %>% summarize(n = n())
ggplot(data = n_isolates) + geom_bar(mapping = aes(x = cx_date, y = n, fill = Loc1), stat = "identity", position = "dodge") + lab(x = "Date (month)", y = "Number of isolates from facility", title = "Distribution of number of isolates by facility over time ")
#plot how many isolates are present in each facil in each month
n_isolates <- snv_dists_df_Penn_dated %>% group_by(cx_date, Loc1) %>% summarize(n = n())
ggplot(data = n_isolates) + geom_bar(mapping = aes(x = cx_date, y = n, fill = Loc1), stat = "identity", position = "dodge") + labs(x = "Date (month)", y = "Number of isolates from facility", title = "Distribution of number of isolates by facility over time ")
library(ape)
library(dplyr)
library(devtools)
load_all()
Penn_test_input <- readRDS(file = "/Users/sophiehoffman/Desktop/regentrans/data/Penn_test_input_2.rds")
locs <- Penn_test_input$locs
pt <- Penn_test_input$pt
fasta <- Penn_test_input$fasta
dists <- Penn_test_input$dists
tr <- Penn_test_input$tr
isolates <- intersect(tr$tip.label, names(locs))
locs_sub <- locs[isolates]
subtrs_sub <- ape::subtrees(tr)
pure_subtrees <- get_largest_subtree(subtrs = subtrs_sub, isolate_labels = locs_sub, bootstrap = bootstrap, pureness = pureness) # NOTE: this function is in snitkitr right now, but I think we should migrate it to this package (or at least include it here as well); this _might_ be buggy, so definitely good to add unit tests for it
pureness = 1
bootstrap = NULL
pure_subtrees <- get_largest_subtree(subtrs = subtrs_sub, isolate_labels = locs_sub, bootstrap = bootstrap, pureness = pureness) # NOTE: this function is in snitkitr right now, but I think we should migrate it to this package (or at least include it here as well); this _might_ be buggy, so definitely good to add unit tests for it
View(pure_subtrees)
View(subtrs_sub)
View(pure_subtrees)
