frac_intra <- get_frac_intra(snv_dists = snv_dists) #or get_frac_intra(dists = dists, locs = locs, pt = pt)
ggplot(data = frac_intra, aes(x = Thresh, y = Frac_Intra)) + geom_bar(stat = "identity", fill = "blue", alpha = 0.5) + labs(x = "SNV Distance Threshold", y = "Fraction of Intra-Facility Pairs") +  ggtitle("Fraction of Isolate Pairs from the Same \nFacility at Each SNV Distance Threshold") + ylim(0, 1) + theme(plot.title = element_text(size = 10))
frac_intra <- get_frac_intra(snv_dists = snv_dists) #or get_frac_intra(dists = dists, locs = locs, pt = pt)
ggplot(data = frac_intra, aes(x = Thresh, y = Frac_Intra)) + geom_bar(stat = "identity", fill = "blue", alpha = 0.5) + labs(x = "SNV Distance Threshold", y = "Fraction of Intra-Facility Pairs") +  ggtitle("Fraction of Isolate Pairs from the Same \nFacility at Each SNV Distance Threshold") + ylim(0, 1)
clusters <- get_clusters(tr,locs, pureness = 1)
#dissect output
pure_subtree_info <- clusters$pure_subtree_info
subtrees <- clusters$subtrees
ggplot(data = pure_subtree_info, aes(x = f_id, y = subtr_size)) + geom_jitter(position = position_jitter(width = 0.2, height = 0.1), alpha = 0.2, color = "blue") + labs(y = "Number of Isolates in \nPhylogenetic Cluster", x = "Facility ID", title = "Pure Subtree Information")
mpr_tree = midpoint.root(tr)
gheatmap(ggtree(mpr_tree, layout = "circular"),as.data.frame(locs), color = NA)
cutoff <- 10 #adjust according to your own analysis!
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Pair_Type) %>% summarize(n = n()) %>% ggplot(aes(x = Loc1, y = n, fill = Pair_Type)) + geom_bar(position = "dodge", stat = "identity") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility ID", title = "Number of Closely Related Isolate Pairs \nby Facility")
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Pair_Type) %>% summarize(n = n())
cutoff <- 10 #adjust according to your own analysis!
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Pair_Type) %>% summarize(n = n()) %>% ggplot(aes(x = Loc1, y = n, fill = Pair_Type)) + geom_bar(position = "dodge", stat = "identity") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility ID", title = "Number of Closely Related Isolate Pairs \nby Facility")
snv_dists_sub <- subset_pairs(snv_dists)
#colors <- c("Intra-facility pair" = "red", "Inter-facility pair" = "blue")
ggplot() +
geom_histogram(data = subset(snv_dists_sub,Pair_Type == "Inter-facility pair"), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2) +
geom_histogram(data = subset(snv_dists_sub,Pair_Type == "Intra-facility pair"), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.4) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") +  ggtitle("SNV distances of intra- and inter- facility pairs")
ggplot() +
geom_histogram(data = subset(snv_dists_sub,Pair_Type == "Inter-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Inter-facility pair"), alpha = 0.2, binwidth = 1) +
geom_histogram(data = subset(snv_dists_sub,Pair_Type == "Intra-facility pair" & Pairwise_Dists < 20), mapping = aes(x = Pairwise_Dists, fill = "Intra-facility pair"), alpha = 0.4, binwidth = 1) + labs(x = "Pairwise SNV Distance", y = "Count", fill = "Legend") +  ggtitle("SNV distances of intra- and inter- facility pairs \n< 20 SNV Distance")
snv_dists
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2, Pair_Type) %>% summarize(n = n())
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2, Pair_Type) %>% summarize(n = n()) %>% mutate (Facil_Pair = paste(Loc1, Loc2))
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2, Pair_Type) %>% summarize(n = n()) %>% mutate (Facil_Pair = paste(Loc1, Loc2)) %>% ggplot(aes(x = Loc1, y = n, fill = Pair_Type)) + geom_bar(position = "dodge", stat = "identity") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility ID", title = "Number of Closely Related Isolate Pairs \nby Facility")
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2, Pair_Type) %>% summarize(n = n()) %>% mutate (Facil_Pair = paste(Loc1, Loc2)) %>% ggplot(aes(x = Facil_Pair, y = n, fill = Pair_Type)) + geom_bar(position = "dodge", stat = "identity") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility ID", title = "Number of Closely Related Isolate Pairs \nby Facility")
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2, Pair_Type) %>% summarize(n = n()) %>% mutate (Facil_Pair = paste(Loc1, Loc2))
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2, Pair_Type) %>% summarize(n = n()) %>% mutate (Facil_Pair = paste(Loc1, Loc2)) %>% filter(n >=  50) %>% ggplot(aes(x = Facil_Pair, y = n, fill = Pair_Type)) + geom_bar(position = "dodge", stat = "identity") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility ID", title = "Number of Closely Related Isolate Pairs \nby Facility")
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2, Pair_Type) %>% summarize(n = n()) %>% mutate (Facil_Pair = paste(Loc1, Loc2)) %>% filter(n >=  40) %>% ggplot(aes(x = Facil_Pair, y = n, fill = Pair_Type)) + geom_bar(position = "dodge", stat = "identity") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility ID", title = "Number of Closely Related Isolate Pairs \nby Facility")
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2, Pair_Type) %>% summarize(n = n()) %>% mutate (Facil_Pair = paste(Loc1, Loc2)) %>% filter(n >=  10) %>% ggplot(aes(x = Facil_Pair, y = n, fill = Pair_Type)) + geom_bar(position = "dodge", stat = "identity") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility ID", title = "Number of Closely Related Isolate Pairs \nby Facility")
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2, Pair_Type) %>% summarize(n = n())
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n())
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% mutate (Facil_Pair = paste(Loc1, Loc2)) %>% filter(n >=  10) %>% ggplot(aes(x = Facil_Pair, y = n, fill = Pair_Type)) + geom_bar(position = "dodge", stat = "identity") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility ID", title = "Number of Closely Related Isolate Pairs \nby Facility")
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% mutate (Facil_Pair = paste(Loc1, Loc2)) %>% filter(n >=  10) %>% ggplot(aes(x = Facil_Pair, y = n)) + geom_bar(position = "dodge", stat = "identity") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility ID", title = "Number of Closely Related Isolate Pairs \nby Facility")
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2)
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% mutate (Facil_Pair = paste(Loc1, Loc2)) %>% filter(n >=  10) %>% ggplot(aes(x = Facil_Pair, y = n)) + geom_bar(position = "dodge", stat = "identity") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility Pair", title = "Number of Closely Related Isolate Pairs \nby Facility Pair")
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% mutate (Facil_Pair = paste(Loc1, Loc2)) %>% filter(n >=  1) %>% ggplot(aes(x = Facil_Pair, y = n)) + geom_bar(position = "dodge", stat = "identity") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility Pair", title = "Number of Closely Related Isolate Pairs \nby Facility Pair")
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% mutate (Facil_Pair = paste(Loc1, Loc2)) %>% filter(n >=  3) %>% ggplot(aes(x = Facil_Pair, y = n)) + geom_bar(position = "dodge", stat = "identity") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility Pair", title = "Number of Closely Related Isolate Pairs \nby Facility Pair")
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% mutate (Facil_Pair = paste(Loc1, Loc2)) %>% filter(n >=  4) %>% ggplot(aes(x = Facil_Pair, y = n)) + geom_bar(position = "dodge", stat = "identity") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility Pair", title = "Number of Closely Related Isolate Pairs \nby Facility Pair")
hi <- snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% mutate (Facil_Pair = paste(Loc1, Loc2)) %>% filter(n >=  4)
hi
mean(hi$n)
facil_pair_snv_dists <- snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% mutate (Facil_Pair = paste(Loc1, Loc2))
n_pair_cutoff <- mean(facil_pair_snv_dists$n)
facil_pair_snv_dists %>% filter(n >=  n_pair_cutoff) %>% ggplot(aes(x = Facil_Pair, y = n)) + geom_bar(position = "dodge", stat = "identity") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility Pair", title = "Number of Closely Related Isolate Pairs \nby Facility Pair")
n_pair_cutoff
facil_pair_snv_dists <- snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% mutate (Facil_Pair = paste(Loc1, Loc2))
facil_pair_snv_dists
mean(facil_pair_snv_dists$n)
facil_pair_snv_dists <- snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% mutate (Facil_Pair = paste(Loc1, Loc2))
n_pair_cutoff <- mean(facil_pair_snv_dists$n)
facil_pair_snv_dists %>% filter(n >=  n_pair_cutoff) %>% ggplot(aes(x = Facil_Pair, y = n)) + geom_bar(position = "dodge", stat = "identity") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility Pair", title = "Number of Closely Related Isolate Pairs \nby Facility Pair")
facil_pair_snv_dists <- snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% mutate (Facil_Pair = paste(Loc1, Loc2))
n_pair_cutoff <- mean(facil_pair_snv_dists$n)
facil_pair_snv_dists %>% filter(n >=  n_pair_cutoff) %>% ggplot(aes(x = Facil_Pair, y = n)) + geom_bar(position = "dodge", stat = "identity", fill = "blue") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility Pair", title = "Number of Closely Related Isolate Pairs \nby Facility Pair")
facil_pair_snv_dists <- snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% mutate (Facil_Pair = paste(Loc1, Loc2))
n_pair_cutoff <- mean(facil_pair_snv_dists$n)
facil_pair_snv_dists %>% filter(n >=  n_pair_cutoff) %>% ggplot(aes(x = Facil_Pair, y = n)) + geom_bar(position = "dodge", stat = "identity", fill = "salmon") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility Pair", title = "Number of Closely Related Isolate Pairs \nby Facility Pair")
facil_pair_snv_dists <- snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% mutate (Facil_Pair = paste(Loc1, Loc2))
n_pair_cutoff <- mean(facil_pair_snv_dists$n)
facil_pair_snv_dists %>% filter(n >=  n_pair_cutoff) %>% ggplot(aes(x = Facil_Pair, y = n)) + geom_bar(position = "dodge", stat = "identity", fill = "salmon") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility Pair", title = "Number of Closely Related Isolate Pairs \nby Facility Pair") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
facil_pair_snv_dists <- snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% mutate (Facil_Pair = paste(Loc1, Loc2))
n_pair_cutoff <- mean(facil_pair_snv_dists$n)
facil_pair_snv_dists %>% filter(n >=  n_pair_cutoff) %>% ggplot(aes(x = Facil_Pair, y = n)) + geom_bar(position = "dodge", stat = "identity", fill = "salmon") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility Pair", title = "Number of Closely Related Isolate Pairs \nby Facility Pair") + theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))
facil_pair_snv_dists <- snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% mutate (Facil_Pair = paste(Loc1, Loc2))
n_pair_cutoff <- mean(facil_pair_snv_dists$n)
facil_pair_snv_dists %>% filter(n >=  n_pair_cutoff) %>% ggplot(aes(x = Facil_Pair, y = n)) + geom_bar(position = "dodge", stat = "identity", fill = "salmon") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility Pair", title = "Number of Closely Related Isolate Pairs \nby Facility Pair") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
facil_pair_snv_dists
snv_dists
facil_pair_snv_dists <- snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% mutate (Facil_Pair = paste(Loc1, Loc2))
n_pair_cutoff <- mean(facil_pair_snv_dists$n)
facil_pair_snv_dists %>% filter(n >=  n_pair_cutoff) %>% ggplot(aes(x = Facil_Pair, y = n)) + geom_bar(position = "dodge", stat = "identity", fill = "salmon") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility Pair", title = "Number of Closely Related Isolate Pairs \nby Facility Pair") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
facil_pair_snv_dists
facil_pair_snv_dists <- snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% mutate (Facil_Pair = paste(Loc1, Loc2)) %>% apply(1, sort) %>% t() %>% filter(!duplicated())
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% mutate (Facil_Pair = paste(Loc1, Loc2)) %>% apply(1, sort) %>% t()
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% subset_pairs() %>% mutate (Facil_Pair = paste(Loc1, Loc2))
load_all()
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% subset_pairs() %>% mutate (Facil_Pair = paste(Loc1, Loc2))
facil_pair_snv_dists <- snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% subset_pairs() %>% mutate (Facil_Pair = paste(Loc1, Loc2))
n_pair_cutoff <- mean(facil_pair_snv_dists$n)
facil_pair_snv_dists %>% filter(n >=  n_pair_cutoff) %>% ggplot(aes(x = Facil_Pair, y = n)) + geom_bar(position = "dodge", stat = "identity", fill = "salmon") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility Pair", title = "Number of Closely Related Isolate Pairs \nby Facility Pair") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
facil_pair_snv_dists <- snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% subset_pairs() %>% mutate(Facil_Pair = paste(Loc1, Loc2)) %>% filter(n >=  mean(n)) %>% ggplot(aes(x = Facil_Pair, y = n)) + geom_bar(position = "dodge", stat = "identity", fill = "salmon") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility Pair", title = "Number of Closely Related Isolate Pairs \nby Facility Pair") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
snv_dists %>% filter(Pairwise_Dists <= cutoff) %>% group_by(Loc1, Loc2) %>% summarize(n = n()) %>% filter(Loc1 != Loc2) %>% subset_pairs() %>% mutate(Facil_Pair = paste(Loc1, Loc2)) %>% filter(n >=  mean(n)) %>% ggplot(aes(x = Facil_Pair, y = n)) + geom_bar(position = "dodge", stat = "identity", fill = "salmon") + labs(y = "Number of Closely Related Isolate Pairs", x = "Facility Pair", title = "Number of Closely Related Isolate Pairs \nby Facility Pair") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
getwd()
####4/5/21
Fsp <- read.csv("Penn_Fsp_output.csv")
View(Fsp)
####4/5/21
Fsp <- read.csv("Penn_Fsp_output.csv", row.names = TRUE)
####4/5/21
Fsp <- read.csv("Penn_Fsp_output.csv", row.names = TRUE)
####4/5/21
Fsp <- read.csv("Penn_Fsp_output.csv", header = TRUE)
Fsp[1,]
Fsp[,1]
rownames(Fsp) <- Fsp[,1]
Fsp[,-1]
Fsp <- Fsp[,-1]
save(Fsp, file="/Users/sophiehoffman/Desktop/regentrans/data/Fsp.RData")
load_all()
regentrans::Fsp
pheatmap(Fsp)
?get_facility_fsp()
pheatmap(Fsp)
pt_trans <- patient_transfer(pt_trans_net = pt_flow, snv_dists = snv_dists, thresh = 10)
ggplot(data = pt_trans, mapping = aes(x = n_transfers, y = n_closely_related_pairs)) + geom_jitter(position = position_jitter(width = 0.2, height = 0.1), alpha = 0.2, color = "blue") + labs(y = "Number of Closely Related Isolate Pairs", x = "Number of Transfers", title = "Number of Patient Transfers from Facility \nvs. Number of Closely Related Isolate Pairs at Facility")
pt_trans
na.omit(data.frame(as.table(as.matrix(Fsp)))) %>% filter(Freq != 0)
na.omit(data.frame(as.table(as.matrix(Fsp)))) %>% filter(Freq != 0) %>% mutate(Facil_1 = Var1, Facil_2 = Var2, Fsp_val = Freq)
na.omit(data.frame(as.table(as.matrix(Fsp)))) %>% filter(Freq != 0) %>% mutate(Facil_1 = Var1, Facil_2 = Var2, Fsp_val = Freq) %>% select(4:6)
na.omit(data.frame(as.table(as.matrix(Fsp)))) %>% filter(Freq != 0) %>% `colnames<-`(c("Facil_1", "Facil_2", "Fsp_val"))
ggplot(data = pt_trans, mapping = aes(x = n_transfers, y = n_closely_related_pairs)) + geom_jitter(position = position_jitter(width = 0.2, height = 0.1), alpha = 0.2, color = "blue") + labs(y = "Number of Closely Related Isolate Pairs", x = "Number of Transfers", title = "Number of Patient Transfers from Facility \nvs. Number of Closely Related Isolate Pairs at Facility")
na.omit(data.frame(as.table(as.matrix(Fsp)))) %>% filter(Freq != 0) %>% `colnames<-`(c("Facil_1", "Facil_2", "Fsp_val"))
na.omit(data.frame(as.table(as.matrix(Fsp)))) %>% filter(Freq != 0) %>% `colnames<-`(c("Facil_1", "Facil_2", "Fsp_val")) %>% subset_pairs()
pt_trans
pt_trans
Fsp_long
Fsp_long <- na.omit(data.frame(as.table(as.matrix(Fsp)))) %>% filter(Freq != 0) %>% `colnames<-`(c("Facil_1", "Facil_2", "Fsp_val")) %>% subset_pairs()
Fsp_long
na.omit(data.frame(as.table(as.matrix(Fsp)))) %>% filter(Freq != 0) %>% `colnames<-`(c("facil_1", "facil_2", "Fsp_val")) %>% subset_pairs() %>% left_join(pt_trans)
Fsp_long <- na.omit(data.frame(as.table(as.matrix(Fsp)))) %>% filter(Freq != 0) %>% `colnames<-`(c("facil_1", "facil_2", "Fsp_val")) %>% subset_pairs() %>% left_join(pt_trans)
ggplot(data = pt_trans, mapping = aes(x = n_transfers, y = Fsp_long)) + geom_jitter(position = position_jitter(width = 0.2, height = 0.1), alpha = 0.2, color = "blue") + labs(y = "Number of Closely Related Isolate Pairs", x = "Number of Transfers", title = "Number of Patient Transfers from Facility \nvs. Number of Closely Related Isolate Pairs at Facility")
Fsp_long <- na.omit(data.frame(as.table(as.matrix(Fsp)))) %>% filter(Freq != 0) %>% `colnames<-`(c("facil_1", "facil_2", "Fsp_val")) %>% subset_pairs() %>% left_join(pt_trans)
ggplot(data = Fsp_long, mapping = aes(x = n_transfers, y = Fsp_long)) + geom_jitter(position = position_jitter(width = 0.2, height = 0.1), alpha = 0.2, color = "blue") + labs(y = "Number of Closely Related Isolate Pairs", x = "Number of Transfers", title = "Number of Patient Transfers from Facility \nvs. Number of Closely Related Isolate Pairs at Facility")
Fsp_long
Fsp_long <- na.omit(data.frame(as.table(as.matrix(Fsp)))) %>% filter(Freq != 0) %>% `colnames<-`(c("facil_1", "facil_2", "Fsp_val")) %>% subset_pairs() %>% left_join(pt_trans)
ggplot(data = Fsp_long, mapping = aes(x = n_transfers, y = Fsp_val)) + geom_jitter(position = position_jitter(width = 0.2, height = 0.1), alpha = 0.2, color = "blue") + labs(y = "Number of Closely Related Isolate Pairs", x = "Number of Transfers", title = "Number of Patient Transfers from Facility \nvs. Number of Closely Related Isolate Pairs at Facility")
Fsp_long <- na.omit(data.frame(as.table(as.matrix(Fsp)))) %>% filter(Freq != 0) %>% `colnames<-`(c("facil_1", "facil_2", "Fsp_val")) %>% subset_pairs() %>% left_join(pt_trans)
ggplot(data = Fsp_long, mapping = aes(x = n_transfers, y = Fsp_val)) + geom_jitter(position = position_jitter(width = 0.2, height = 0.1), alpha = 0.2, color = "blue") + labs(y = "Fsp (population-level similarity)", x = "Number of Transfers", title = "Number of Patient Transfers from Facility \nvs. Fsp (population-level similarity)")
Fsp_long
library(ape)
library(dplyr)
library(devtools)
library(ggtree)
library(pheatmap)
library(ggplot2)
library(phytools)
library(gridExtra)
#set theme
theme_set(theme_bw() + theme(strip.background = element_rect(fill="white",linetype='blank'), text=element_text(size=15)))
Fsp_long <- na.omit(data.frame(as.table(as.matrix(Fsp)))) %>% filter(Freq != 0) %>% `colnames<-`(c("facil_1", "facil_2", "Fsp_val")) %>% subset_pairs() %>% left_join(pt_trans)
ggplot(data = Fsp_long, mapping = aes(x = n_transfers, y = Fsp_val)) + geom_jitter(position = position_jitter(width = 0.2, height = 0.1), alpha = 0.2, color = "blue") + labs(y = "Fsp (population-level similarity)", x = "Number of Transfers", title = "Number of Patient Transfers from Facility \nvs. Fsp (population-level similarity)") + geom_smooth(method = "lm")
pt_trans <- patient_transfer(pt_trans_net = pt_flow, snv_dists = snv_dists, thresh = 10)
ggplot(data = pt_trans, mapping = aes(x = n_transfers, y = n_closely_related_pairs)) + geom_jitter(position = position_jitter(width = 0.2, height = 0.1), alpha = 0.2, color = "blue") + labs(y = "Number of Closely Related Isolate Pairs", x = "Number of Transfers", title = "Number of Patient Transfers from Facility \nvs. Number of Closely Related Isolate Pairs at Facility") + geom_smooth(method = "lm")
facilities <- unique(locs)
facilities
n
longitudes
sample(-180:180, length(facilities))
longitudes <- sample(-180:180, length(facilities))
facilities <- unique(locs)
longitudes <- sample(-180:180, length(facilities))
latitudes <- sample(-90,90, length(facilities))
facil_geo <- cbind(facilities, longitudes, latitudes)
facil_geo
facilities <- unique(locs)
longitudes <- sample(-180:180, length(facilities))
latitudes <- sample(-90:90, length(facilities))
facil_geo <- cbind(facilities, longitudes, latitudes)
facil_geo
facil_geo <- as.data.frame(cbind(facilities, longitudes, latitudes))
facil_geo
facilities <- unique(locs)
longitudes <- as.numeric(sample(-180:180, length(facilities)))
latitudes <- as.numeric(sample(-90:90, length(facilities)))
facil_geo <- as.data.frame(cbind(facilities, longitudes, latitudes))
facil_geo
facilities <- unique(locs)
longitudes <- sample(-180:180, length(facilities))
latitudes <- (sample(-90:90, length(facilities)))
facil_geo <- as.data.frame(cbind(facilities, longitudes, latitudes))
facil_geo$longitudes <- as.numeric(facil_geo$longitudes)
facil_geo$latitudes <- as.numeric(facil_geo$latitudes)
head(facil_geo)
set.seed(1)
facilities <- unique(locs)
longitudes <- sample(-180:180, length(facilities))
latitudes <- (sample(-90:90, length(facilities)))
facil_geo <- as.data.frame(cbind(facilities, longitudes, latitudes))
facil_geo$longitudes <- as.numeric(facil_geo$longitudes)
facil_geo$latitudes <- as.numeric(facil_geo$latitudes)
head(facil_geo)
set.seed(1)
facilities <- unique(locs)
longitudes <- sample(-180:180, length(facilities))
latitudes <- (sample(-90:90, length(facilities)))
facil_geo <- as.data.frame(cbind(facilities, longitudes, latitudes))
facil_geo$longitudes <- as.numeric(facil_geo$longitudes)
facil_geo$latitudes <- as.numeric(facil_geo$latitudes)
head(facil_geo)
pt_trans
Fsp_long
locs
locs %>% table()
locs %>% table() %>% as.data.frame()
locs %>% table() %>% as.data.frame() %>% `colnames()<-`(c("facilities", "n"))
locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo %>% left_join(loc_n)
?boarders()
?borders()
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo %>% left_join(loc_n) %>% ggplot(aes(x=longitude, y=latitude), color = "grey99") +
geom_point(aes(size=n), alpha=0.5) +
borders(database="world", regions = 'USA') +
coord_quickmap() +
theme_void() + theme(legend.position = "none")
facil_geo %>% left_join(loc_n)
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo %>% left_join(loc_n) %>% ggplot(aes(x=longitudes, y=latitudes), color = "grey99") +
geom_point(aes(size=n), alpha=0.5) +
borders(database="world", regions = 'USA') +
coord_quickmap() +
theme_void() + theme(legend.position = "none")
set.seed(1)
facilities <- unique(locs)
longitudes <- sample(50:30, length(facilities))
latitudes <- (sample(75:125, length(facilities)))
facil_geo <- as.data.frame(cbind(facilities, longitudes, latitudes))
facil_geo$longitudes <- as.numeric(facil_geo$longitudes)
facil_geo$latitudes <- as.numeric(facil_geo$latitudes)
head(facil_geo)
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo %>% left_join(loc_n) %>% ggplot(aes(x=longitudes, y=latitudes), color = "grey99") +
geom_point(aes(size=n), alpha=0.5) +
borders(database="world", regions = 'USA') +
coord_quickmap() +
theme_void() + theme(legend.position = "none")
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo %>% left_join(loc_n) %>% ggplot(aes(x=latitudes, y=longitudes), color = "grey99") +
geom_point(aes(size=n), alpha=0.5) +
borders(database="world", regions = 'USA') +
coord_quickmap() +
theme_void() + theme(legend.position = "none")
set.seed(1)
facilities <- unique(locs)
longitudes <- sample(30:50, length(facilities))
latitudes <- (sample(75:125, length(facilities)))
facil_geo <- as.data.frame(cbind(facilities, longitudes, latitudes))
facil_geo$longitudes <- as.numeric(facil_geo$longitudes)
facil_geo$latitudes <- as.numeric(facil_geo$latitudes)
head(facil_geo)
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo %>% left_join(loc_n) %>% ggplot(aes(x=latitudes, y=longitudes), color = "grey99") +
geom_point(aes(size=n), alpha=0.5) +
borders(database="world", regions = 'USA') +
coord_quickmap() +
geom_rect(aes(xmin = 75, xmax = 125, ymin = 30, ymax = 50), fill = "transparent", color = "darkgrey", size = 0.5) +
theme_void() + theme(legend.position = "none")
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo %>% left_join(loc_n) %>% ggplot(aes(x=latitudes, y=longitudes), color = "grey99") +
geom_point(aes(size=n), alpha=0.5) +
borders(database="world", regions = 'USA') +
coord_quickmap() +
theme_void() + theme(legend.position = "none")
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo %>% left_join(loc_n) %>% ggplot(aes(x=latitudes, y=longitudes), color = "grey99") +
geom_point(aes(size=n), alpha=0.5) +
#borders(database="world", regions = 'USA') +
coord_quickmap() +
theme_void() + theme(legend.position = "none")
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo %>% left_join(loc_n) %>% ggplot(aes(x=latitudes, y=longitudes), color = "grey99") +
geom_point(aes(size=n), alpha=0.5) +
borders(database="world", regions = 'USA') +
coord_quickmap() +
theme_void() + theme(legend.position = "none")
data(us.cities)
force(us.cities)
cities <- data(us.cities)
cities
data(us.cities)
force(us.cities)
cities <- force(us.cities)
cities
cities_sub <- cities[1:length(facilities),4:5]
cities_sub
facil_geo <- as.data.frame(cbind(facilities, cities_sub))
facil_geo
cities <- force(us.cities)
facilities <- unique(locs)
cities_sub <- cities[1:length(facilities),4:5]
facil_geo <- as.data.frame(cbind(facilities, cities_sub))
head(facil_geo)
facilities <- unique(locs)
facilities
cities <- force(us.cities)
facilities <- unique(locs)
cities_sub <- cities[1:length(facilities),4:5]
facil_geo <- as.data.frame(cbind(facilities, cities_sub))
head(facil_geo)
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo %>% left_join(loc_n) %>% ggplot(aes(x=latitudes, y=longitudes), color = "grey99") +
geom_point(aes(size=n), alpha=0.5) +
borders(database="world", regions = 'USA') +
coord_quickmap() +
theme_void() + theme(legend.position = "none")
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo %>% left_join(loc_n) %>% ggplot(aes(x=latitudes, y=longitudes), color = "grey99") +
geom_point(aes(size=n), alpha=0.5) +
borders("state") +
coord_quickmap() +
theme_void() + theme(legend.position = "none")
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo %>% left_join(loc_n) %>% ggplot(aes(x=latitudes, y=longitudes), color = "grey99") +
geom_point(aes(size=n), alpha=0.5) +
borders("state") + scale_size_area() +
coord_quickmap() +
theme_void() + theme(legend.position = "none")
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo %>% left_join(loc_n) %>% ggplot(aes(x=long, y=lat), color = "grey99") +
geom_point(aes(size=n), alpha=0.5) +
borders("state")
coord_quickmap() +
theme_void() + theme(legend.position = "none")
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo %>% left_join(loc_n) %>% ggplot(aes(x=long, y=lat), color = "grey99") +
geom_point(aes(size=n), alpha=0.5) +
borders("state") +
coord_quickmap() +
theme_void() + theme(legend.position = "none")
cities_sub
cities_sub <- cities[1:length(facilities),]
cities_sub
cities
cities <- force(us.cities) %>% filter(!country.etc %in% c("HI", "AK"))
facilities <- unique(locs)
cities_sub <- cities[1:length(facilities),4:5]
facil_geo <- as.data.frame(cbind(facilities, cities_sub))
head(facil_geo)
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo %>% left_join(loc_n) %>% ggplot(aes(x=long, y=lat), color = "grey99") +
geom_point(aes(size=n), alpha=0.5) +
borders("state") +
coord_quickmap() +
theme_void() + theme(legend.position = "none")
loc_n
Fsp
Fsp_long
loc_n %>% inner_join(Fsp_long, by = c("facilities" = "facil_1"))
facil_geo %>% left_join(loc_n) %>% inner_join(Fsp_long, by = c("facilities" = "facil_1"))
facil_geo %>% left_join(loc_n) %>% inner_join(Fsp_long, by = c("facil_1" = "facilities"))
facil_geo %>% left_join(loc_n) %>% inner_join(Fsp_long, by = c("facilities" = "facil_1")) %>% rename(facilities = facil_1)
facil_geo %>% left_join(loc_n) %>% inner_join(Fsp_long, by = c("facilities" = "facil_1")) %>% rename(facilities = "facil_1")
facil_geo %>% left_join(loc_n) %>% inner_join(Fsp_long, by = c("facilities" = "facil_1")) %>% rename(facilities = "facil_1")
facil_geo %>% left_join(loc_n)
Fsp_long
facil_geo %>% left_join(loc_n) %>% inner_join(Fsp_long, by = c("facilities" = "facil_1"))
facil_geo %>% left_join(loc_n) %>% inner_join(Fsp_long, by = c("facilities" = "facil_1")) %>% rename("facilities" = "facil_1")
facil_geo %>% left_join(loc_n) %>% inner_join(Fsp_long, by = c("facilities" = "facil_1")) %>% rename(facilities = facil_1)
facil_geo %>% left_join(loc_n) %>% inner_join(Fsp_long, by = c("facilities" = "facil_1")) %>% rename(facil_1 = facilities)
facil_geo %>% left_join(loc_n) %>% inner_join(Fsp_long, by = c("facilities" = "facil_1")) %>% rename(facil_1 = facilities)
facil_geo %>% left_join(loc_n) %>% inner_join(Fsp_long, by = c("facilities" = "facil_1")) %>% rename(facil_1 = facilities, facil_1_lat = lat, facil_1_long = long, facil_1_n = n) %>% inner_join(Fsp_long, by = c("facilities" = "facil_2")) %>% rename(facil_2 = facilities, facil_2_lat = lat, facil_2_long = long, facil_2_n = n)
facil_geo %>% left_join(loc_n) %>% inner_join(Fsp_long, by = c("facilities" = "facil_1")) %>% rename(facil_1 = facilities, facil_1_lat = lat, facil_1_long = long, facil_1_n = n)
facil_geo %>% left_join(loc_n) %>% inner_join(Fsp_long, by = c("facilities" = "facil_1")) %>% rename(facil_1 = facilities, facil_1_lat = lat, facil_1_long = long, facil_1_n = n) %>% inner_join(Fsp_long, by = c("facilities" = "facil_2"))
Fsp_long
facil_geo %>% left_join(loc_n) %>% inner_join(Fsp_long, by = c("facilities" = "facil_1")) %>% rename(facil_1 = facilities, facil_1_lat = lat, facil_1_long = long, facil_1_n = n)
Fsp_long
facil_geo %>% left_join(loc_n) %>% inner_join(Fsp_long, by = c("facilities" = "facil_1")) %>% rename(facil_1 = facilities, facil_1_lat = lat, facil_1_long = long, facil_1_n = n) %>% inner_join(Fsp_long, by = c("facil_2" = "facil_2")) %>% rename(facil_2 = facilities, facil_2_lat = lat, facil_2_long = long, facil_2_n = n)
facil_geo %>% left_join(loc_n) %>% inner_join(Fsp_long, by = c("facilities" = "facil_1")) %>% rename(facil_1 = facilities, facil_1_lat = lat, facil_1_long = long, facil_1_n = n) %>% inner_join(Fsp_long, by = c("facil_2" = "facil_2"))
Fsp_long %>% left_join(facil_geo, by = c("facilities" = "facil_1")) %>% rename(facil_1 = facilities, facil_1_lat = lat, facil_1_long = long, facil_1_n = n)
facil_geo <- facil_geo %>% left_join(loc_n)
Fsp_long %>% left_join(facil_geo, by = c("facilities" = "facil_1")) %>% rename(facil_1 = facilities, facil_1_lat = lat, facil_1_long = long, facil_1_n = n)
facil_geo
facil_geo <- as.data.frame(cbind(facilities, cities_sub))
head(facil_geo)
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo <- facil_geo %>% left_join(loc_n)
facil_geo
Fsp_long
Fsp_long %>% left_join(facil_geo, by = c("facil_1" = "facilities"))
Fsp_long %>% left_join(facil_geo, by = c("facil_1" = "facilities")) %>% rename(facil_1 = facilities, facil_1_lat = lat, facil_1_long = long, facil_1_n = n)
Fsp_long %>% left_join(facil_geo, by = c("facil_1" = "facilities"))
Fsp_long %>% left_join(facil_geo, by = c("facil_1" = "facilities")) %>% rename(facil_1_lat = lat, facil_1_long = long, facil_1_n = n)
Fsp_long %>% left_join(facil_geo, by = c("facil_1" = "facilities")) %>% rename(facil_1_lat = lat, facil_1_long = long, facil_1_n = n) %>% left_join(facil_geo, by = c("facil_2" = "facilities"))
Fsp_long %>% left_join(facil_geo, by = c("facil_1" = "facilities")) %>% rename(facil_1_lat = lat, facil_1_long = long, facil_1_n = n) %>% left_join(facil_geo, by = c("facil_2" = "facilities")) %>% rename(facil_2_lat = lat, facil_2_long = long, facil_2_n = n)
Fsp_geo <- Fsp_long %>% left_join(facil_geo, by = c("facil_1" = "facilities")) %>% rename(facil_1_lat = lat, facil_1_long = long, facil_1_n = n) %>% left_join(facil_geo, by = c("facil_2" = "facilities")) %>% rename(facil_2_lat = lat, facil_2_long = long, facil_2_n = n)
Fsp_geo
facil_geo
facil_geo %>% ggplot(aes(x=long, y=lat), color = "grey99") +
geom_point(aes(size=n), alpha=0.5) +
borders("state") +
coord_quickmap() +
geom_curve(aes(x = facil_1_long, y = facil_1_lat, xend = facil_2_long, yend = facil_2_lat,     # draw edges as arcs
size = n/max(n)),
data = Fsp_geo, curvature = 0.33,
alpha = 0.2) +
theme_void() + theme(legend.position = "none")
Fsp_geo
facil_geo %>% ggplot(aes(x=long, y=lat), color = "grey99") +
geom_point(aes(size=n), alpha=0.5) +
borders("state") +
coord_quickmap() +
geom_curve(aes(x = facil_1_long, y = facil_1_lat, xend = facil_2_long, yend = facil_2_lat,     # draw edges as arcs
size = Fsp_val),
data = Fsp_geo, curvature = 0.33,
alpha = 0.2) +
theme_void() + theme(legend.position = "none")
facil_geo %>% ggplot(aes(x=long, y=lat), color = "blue") +
geom_point(aes(size=n), alpha=0.5) +
borders("state") +
coord_quickmap() +
geom_curve(aes(x = facil_1_long, y = facil_1_lat, xend = facil_2_long, yend = facil_2_lat,     # draw edges as arcs
size = Fsp_val),
data = Fsp_geo, curvature = 0.33,
alpha = 0.2) +
theme_void() + theme(legend.position = "none")
facil_geo %>% ggplot(aes(x=long, y=lat)) +
geom_point(aes(size=n), alpha=0.5) +
borders("state") +
coord_quickmap() +
geom_curve(aes(x = facil_1_long, y = facil_1_lat, xend = facil_2_long, yend = facil_2_lat,     # draw edges as arcs
size = Fsp_val),
data = Fsp_geo, curvature = 0.33,
alpha = 0.2) +
theme_void() + theme(legend.position = "none")
facil_geo %>% ggplot(aes(x=long, y=lat), color = "blue") +
geom_point(aes(size=n), alpha=0.5) +
borders("state") +
coord_quickmap() +
geom_curve(aes(x = facil_1_long, y = facil_1_lat, xend = facil_2_long, yend = facil_2_lat,     # draw edges as arcs
size = Fsp_val),
data = Fsp_geo, curvature = 0.33,
alpha = 0.2) +
theme_void() + theme(legend.position = "none")
cities <- force(us.cities) %>% filter(!country.etc %in% c("HI", "AK"))
facilities <- unique(locs)
cities_sub <- cities[1:length(facilities),4:5]
facil_coord <- as.data.frame(cbind(facilities, cities_sub))
head(facil_geo)
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo <- facil_coord %>% left_join(loc_n)
Fsp_geo <- Fsp_long %>% left_join(facil_geo, by = c("facil_1" = "facilities")) %>% rename(facil_1_lat = lat, facil_1_long = long, facil_1_n = n) %>% left_join(facil_geo, by = c("facil_2" = "facilities")) %>% rename(facil_2_lat = lat, facil_2_long = long, facil_2_n = n)
facil_geo %>% ggplot(aes(x=long, y=lat)) +
geom_point(aes(size=n), alpha=0.5) +
borders("state") +
coord_quickmap() +
geom_curve(aes(x = facil_1_long, y = facil_1_lat, xend = facil_2_long, yend = facil_2_lat,     # draw edges as arcs
size = Fsp_val),
data = Fsp_geo, curvature = 0.33,
alpha = 0.2) +
theme_void() + theme(legend.position = "none")
pt_trans
facil_geo
pt_trans
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo <- facil_coord %>% left_join(loc_n)
trans_geo <- pt_trans %>% left_join(facil_geo, by = c("facil_1" = "facilities")) %>% rename(facil_1_lat = lat, facil_1_long = long, facil_1_n = n) %>% left_join(facil_geo, by = c("facil_2" = "facilities")) %>% rename(facil_2_lat = lat, facil_2_long = long, facil_2_n = n)
facil_geo %>% ggplot(aes(x=long, y=lat)) +
geom_point(aes(size=n), alpha=0.5) +
borders("state") +
coord_quickmap() +
geom_curve(aes(x = facil_1_long, y = facil_1_lat, xend = facil_2_long, yend = facil_2_lat,     # draw edges as arcs
size = n_transfers),
data = trans_geo, curvature = 0.33,
alpha = 0.2) +
theme_void() + theme(legend.position = "none")
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo <- facil_coord %>% left_join(loc_n)
trans_geo <- pt_trans %>% left_join(facil_geo, by = c("facil_1" = "facilities")) %>% rename(facil_1_lat = lat, facil_1_long = long, facil_1_n = n) %>% left_join(facil_geo, by = c("facil_2" = "facilities")) %>% rename(facil_2_lat = lat, facil_2_long = long, facil_2_n = n)
facil_geo %>% ggplot(aes(x=long, y=lat)) +
geom_point(aes(size=n), alpha=0.5) +
borders("state") +
coord_quickmap() +
geom_curve(aes(x = facil_1_long, y = facil_1_lat, xend = facil_2_long, yend = facil_2_lat,     # draw edges as arcs
size = n_transfers/max(n)),
data = trans_geo, curvature = 0.33,
alpha = 0.2) +
theme_void() + theme(legend.position = "none")
loc_n <- locs %>% table() %>% as.data.frame() %>% `colnames<-`(c("facilities", "n"))
facil_geo <- facil_coord %>% left_join(loc_n)
trans_geo <- pt_trans %>% left_join(facil_geo, by = c("facil_1" = "facilities")) %>% rename(facil_1_lat = lat, facil_1_long = long, facil_1_n = n) %>% left_join(facil_geo, by = c("facil_2" = "facilities")) %>% rename(facil_2_lat = lat, facil_2_long = long, facil_2_n = n)
facil_geo %>% ggplot(aes(x=long, y=lat)) +
geom_point(aes(size=n), alpha=0.5) +
borders("state") +
coord_quickmap() +
geom_curve(aes(x = facil_1_long, y = facil_1_lat, xend = facil_2_long, yend = facil_2_lat,     # draw edges as arcs
size = n_transfers/max(n_transfers)),
data = trans_geo, curvature = 0.33,
alpha = 0.2) +
theme_void() + theme(legend.position = "none")
facil_geo %>% ggplot(aes(x=long, y=lat)) +
geom_point(aes(size=n), alpha=0.5, color = "blue") +
borders("state") +
coord_quickmap() +
geom_curve(aes(x = facil_1_long, y = facil_1_lat, xend = facil_2_long, yend = facil_2_lat,     # draw edges as arcs
size = n_transfers/max(n_transfers)),
data = trans_geo, curvature = 0.33,
alpha = 0.2) +
theme_void() + theme(legend.position = "none")
i
facil_geo %>% ggplot(aes(x=long, y=lat)) +
borders("state") +
coord_quickmap() +
geom_curve(aes(x = facil_1_long, y = facil_1_lat, xend = facil_2_long, yend = facil_2_lat,     # draw edges as arcs
size = n_transfers/max(n_transfers)),
data = trans_geo, curvature = 0.33,
alpha = 0.2) +
geom_point(aes(size=n), alpha=0.5, color = "blue") +
theme_void() + theme(legend.position = "none")
facil_geo %>% ggplot(aes(x=long, y=lat)) +
geom_point(aes(size=n), alpha=0.5, color = "blue", fill = "blue") +
borders("state") +
coord_quickmap() +
geom_curve(aes(x = facil_1_long, y = facil_1_lat, xend = facil_2_long, yend = facil_2_lat,     # draw edges as arcs
size = n_transfers/max(n_transfers)),
data = trans_geo, curvature = 0.33,
alpha = 0.2) +
theme_void() + theme(legend.position = "none")
